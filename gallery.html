<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WRAP.EXE</title>
  <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/rabbit-white.gif" type="image/png">
</head>

<body>
  <div class="gallery-header">
    <h1 id="gallery-title" tabindex="0">Textures</h1>
    <a href="index.html" class="back-button" tabindex="0">Back</a>
  </div>

  <main>
    <div id="gallery" class="gallery-grid" tabindex="0" aria-label="Gallery grid"></div>

    <div class="car" tabindex="0" aria-label="Car render">
      <div id="car-viewer"></div>
    </div>
  </main>

  <!-- Import map for Three.js -->
  <script type="importmap">
  {
    "imports": {
      "three": "./three.js-master/build/three.module.js",
      "three/addons/": "./three.js-master/examples/jsm/"
    }
  }
  </script>

  <!-- 3D car viewer -->
  <script type="module" src="car.js"></script>

  <!-- Gallery logic -->
  <script>
    function qs(name) {
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }

    const category = qs('name');
    const titleEl = document.getElementById('gallery-title');
    const gallery = document.getElementById('gallery');

    if (!category) {
      titleEl.textContent = 'No category specified';
      gallery.textContent = 'Use the index page to pick a category.';
    } else {
      fetch('./manifest.json')
        .then(r => r.json())
        .then(manifest => {
          const info = manifest.info || {};
          const list = manifest.catalogue || manifest;
          const item = list.find(i => i.name === category);

          titleEl.textContent = item
            ? (item.niceName || item.name)
            : category;

          if (!item) {
            gallery.textContent = 'Category not found in manifest.';
            return;
          }

          const base =
            (info.base_url || '.') + '/' +
            (info.textures_folder || 'textures') + '/' +
            item.name + '/';

          item.files.forEach(fname => {
            const img = document.createElement('img');
            img.className = 'thumb';
            img.src = base + fname;
            img.alt = fname;

            img.addEventListener('click', () => {
              // remove highlight from all thumbnails
              document.querySelectorAll('.thumb')
                .forEach(t => t.classList.remove('selected'));

              // highlight this one
              img.classList.add('selected');

              // notify car.js
              const ev = new CustomEvent('texture-selected', {
                detail: { src: img.src, name: fname }
              });
              window.dispatchEvent(ev);
            });

            gallery.appendChild(img);
          });
        })
        .catch(err => {
          titleEl.textContent = 'Failed to load manifest';
          gallery.textContent = 'Check console for details.';
          console.error(err);
        });
    }
  </script>

  <footer class="gallery-footer" tabindex="0">
    This work is based on <a href="https://sketchfab.com/3d-models/car-2f00a5cb6263445cbee828fabd7e0632" target="_blank">"Car"</a> by <a href="https://sketchfab.com/Deepu.Dra" target="_blank">Tech developers</a> licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC-BY-4.0</a>.
  </footer>
</body>
</html>
